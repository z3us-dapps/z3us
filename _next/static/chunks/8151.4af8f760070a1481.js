(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8151],{72797:function(e,a,t){"use strict";t.d(a,{Hz:function(){return l}});var s=t(52322),n=t(2784),r=t(48675),i=t(9219);let l=(0,n.forwardRef)((e,a)=>{let{isPassword:t,onChange:n,hasError:i,styleVariant:l="primary",...o}=e;return(0,s.jsx)(r.I,{...o,styleVariant:i?"primary"===l?"primary-error":"secondary-error":l,type:t?"password":"text",ref:a,onChange:e=>{let a=e.nativeEvent;a.isComposing||n(e.target.value)}})}),o=(0,n.forwardRef)((e,a)=>{let{validate:t,name:n,label:r,isPassword:o,hidden:c,...d}=e;return(0,s.jsx)(i.n,{name:n,label:r,validate:t,hidden:c,children:(0,s.jsx)(l,{...d,isPassword:o,hidden:!0,ref:a})})});a.ZP=o},66568:function(e,a,t){"use strict";t.r(a),t.d(a,{Swap:function(){return ee},default:function(){return ea}});var s=t(52322),n=t(2784),r=t(49177),i=t(83112),l=t(73557),o=t(39857),c=t(8522),d=t(23554),u=t(18917),m=t(99040),f=t(36650),p=t(43207),g=t(68080),_=t(65098),x=t(44150),h=t(2827);let z="astrolecent";var v=t(7540),j=t(38059),M=t(86363),b=t(47843),k=t(12348),w=t(73452),y=t(12132),A=t(98076),O=t(97101),E=t(72797),T=t(65577),N=t(70440),S=t(50945),C=t(7982),F=t(28694),L=t(43789),P=t(26810),K=t(26494),R=t(29774),H=t(47324),Z=t(35305),D=t(77822),I=t(16803),W=t(57635),q=t(91316),B=t(24240);let V=(e,a,t,s,r)=>{let{data:i}=(0,Z.pH)(t),[l,o]=(0,n.useState)(r>0),[c,d]=(0,n.useState)(""),[u,m]=(0,n.useState)(0),[f,p]=(0,n.useState)(0),{data:g,error:_,isFetching:x}=(0,q.G_)(e,a,t,s,r),h=e=>{let{divisibility:a}=e;"send"===s?(m(r),p(.997*g.outputTokens)):(m(g.inputTokens),p(r));let n=(0,B.O)(),i='\n			TAKE_FROM_WORKTOP\n				Address("'.concat(t,'")\n				Decimal("').concat((.003*g.outputTokens).toFixed(a),'")\n				Bucket("fee_bucket').concat(n,'")\n			;\n			CALL_METHOD\n				Address("').concat(W.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(n,'")\n				Enum<0u8>()\n			;\n		'),l=g.manifest.lastIndexOf("CALL_METHOD"),o="".concat(g.manifest.substring(0,l),"\n").concat(i,"\n").concat(g.manifest.substring(l));d(o)};return(0,n.useEffect)(()=>{if(x){o(!0);return}i&&(d(""),g?(h(i.details),o(!1)):_&&o(!1))},[e,t,i,x,g,_]),{dex:z,allowsReceive:!1,isLoading:l,error:_,manifest:c,sendAmount:u,receiveAmount:f,price:f>0?u/f:0,priceImpact:(null==g?void 0:g.priceImpact)||0,swapFee:(null==g?void 0:g.swapFee)||0}};var G=t(84192);let U=(e,a,t,s,r)=>{let{data:i}=(0,Z.pH)(t),{data:l,error:o,isFetching:c}=(0,G.G_)(a,t,s,r),[d,u]=(0,n.useState)(r>0),[m,f]=(0,n.useState)(""),[p,g]=(0,n.useState)(0),[_,x]=(0,n.useState)(0),h=t=>{let{divisibility:s}=t,n=l.input_address===a?"send":"receive",i="send"===n?"input":"output",o="send"===n?"output":"input";"send"===n?(g(r),x(.997*Number.parseFloat(l["".concat(o,"_amount")].token))):(g(Number.parseFloat(l["".concat(i,"_amount")].token)),x(r));let c=(0,B.O)(),d=l.swaps.reduce((a,t)=>"\n		".concat(a,'\n			CALL_METHOD\n				Address("').concat(e,'")\n				"withdraw"\n				Address("').concat(t["".concat(i,"_address")],'")\n				Decimal("').concat(t["".concat(i,"_amount")].token,'")\n			;\n			TAKE_ALL_FROM_WORKTOP\n				Address("').concat(t["".concat(i,"_address")],'")\n				Bucket("bucket').concat(c,'")\n			;\n			CALL_METHOD\n				Address("').concat(t.pool_address,'")\n				"swap"\n				Bucket("bucket').concat(c,'")\n			;\n			TAKE_FROM_WORKTOP\n				Address("').concat(t["".concat(o,"_address")],'")\n				Decimal("').concat((.003*Number.parseFloat(t["".concat(o,"_amount")].token)).toFixed(s),'")\n				Bucket("fee_bucket').concat(c,'")\n			;\n			CALL_METHOD\n				Address("').concat(W.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(c,'")\n				Enum<0u8>()\n			;\n			CALL_METHOD\n				Address("').concat(e,'")\n				"deposit_batch"\n				Expression("ENTIRE_WORKTOP")\n			;\n		'),"");f(d)};return(0,n.useEffect)(()=>{if(c){u(!0);return}i&&(f(""),l?(h(i.details),u(!1)):o&&u(!1))},[e,a,i,c,l,o]),{dex:"oci",allowsReceive:!0,isLoading:d,error:o,manifest:m,sendAmount:p,receiveAmount:_,price:_>0?p/_:0,priceImpact:l?Number.parseFloat(l.price_impact):0,swapFee:l?Number.parseFloat(l.input_fee_lp.token):0}};t(41486),t(32642),t(55827),t(52311);let X={oci:R.l.OCI_SWAP,[z]:R.l.ASTROLESCENT},$=(0,r.vU)({fee_wallet:{id:"PyXtpD",defaultMessage:"Wallet fee"},fee_lp:{id:"OS5a2i",defaultMessage:"Pool fee"},price_impact:{id:"WBB92z",defaultMessage:"Price impact"},price_impact_info:{id:"MoWYiJ",defaultMessage:"Price impact is the influence of user&apos;s individual trade over the market price of an underlying asset pair. It is directly correlated with the amount of liquidity in the pool. Price impact can be especially high for illiquid markets/pairs, and may cause a trader to lose a significant portion of their funds."},account_placeholder:{defaultMessage:"Select account",id:"0+6+jP"},swap_lading_error:{defaultMessage:"Swap preview is loading...",id:"dgs4z4"},dex:{id:"ifOb7y",defaultMessage:"Dex"},dex_oci:{id:"eyMKyf",defaultMessage:"OCI"},dex_astrolecent:{id:"CrAj8T",defaultMessage:"Astrolecent"}});var J=()=>{var e,a;let t=(0,i.Z)(),r=(0,n.useRef)(null),{onFieldChange:l}=(0,n.useContext)(w.q),{name:o}=(0,n.useContext)(y.z),c=(0,N.K)("".concat(o?"".concat(o,"."):"","dex")),d=(0,N.K)("".concat(o?"".concat(o,"."):"","account"))||"",m=(0,N.K)("".concat(o).concat(o?".":"","from[0]")),p=(0,N.K)("".concat(o).concat(o?".":"","to[0]")),g=(0,D.r)(),{data:_}=(0,Z.pH)(null==p?void 0:p.address),{data:{fungibleBalances:x=[]}}=(0,H.ln)([d]),v=(0,I.vK)("symbol",null==_?void 0:null===(e=_.metadata)||void 0===e?void 0:e.items),j=(0,n.useMemo)(()=>x.filter(e=>!!(null==g?void 0:g[e.address])).map(e=>e.address),[x,g]),M=(0,n.useMemo)(()=>Object.keys(g||{}),[g]),[b,R]=(0,n.useState)("send"),W=(0,n.useMemo)(()=>"send"===b?Number.parseFloat((null==m?void 0:m.amount)||"0"):Number.parseFloat((null==p?void 0:p.amount)||"0"),[b,m,p]),q=(0,n.useMemo)(()=>.003*Number.parseFloat((null==p?void 0:p.amount)||"0"),[null==p?void 0:p.amount]),B=U(d,null==m?void 0:m.address,null==p?void 0:p.address,b,W),G=V(d,null==m?void 0:m.address,null==p?void 0:p.address,b,W);(0,n.useEffect)(()=>{var e;null==r||null===(e=r.current)||void 0===e||e.focus()},[null==r?void 0:r.current]);let J=(0,n.useMemo)(()=>{let e={oci:B,[z]:G},a=Object.keys(e).sort((a,t)=>e[a].price-e[t].price);return a.map((n,r)=>({id:n,title:(0,s.jsxs)(u.x,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"small",children:[(0,s.jsxs)(u.x,{paddingLeft:"small",display:"flex",alignItems:"center",gap:"small",children:[(0,s.jsx)(C.H,{size:"small",address:X[n]}),(0,s.jsx)(L.Z,{children:t.formatMessage($["dex_".concat(n)])})]}),r>0&&e[n].price>0&&(0,s.jsx)(P.Z,{size:"large",change:0===r?1:-1,children:t.formatNumber((e[a[0]].price-e[n].price)/e[n].price,K.Bp)})]})}))},[B,G]);(0,n.useEffect)(()=>{c||""===B.manifest||""===G.manifest||(B.error?l("".concat(o).concat(o?".":"","dex"),z):G.error?l("".concat(o).concat(o?".":"","dex"),"oci"):l("".concat(o).concat(o?".":"","dex"),B.price>G.price?z:"oci"))},[B.manifest,B.error,B.sendAmount,B.receiveAmount,G.manifest,G.error,G.sendAmount,G.receiveAmount]);let Q=(0,n.useMemo)(()=>{switch(c){case"oci":return B;case z:return G;default:return null}},[c,B,G]);(0,n.useEffect)(()=>{Q&&l("".concat(o).concat(o?".":"","manifest"),Q.manifest)},[null==Q?void 0:Q.manifest]),(0,n.useEffect)(()=>{Q&&l("".concat(o).concat(o?".":"","from[0].amount"),Q.sendAmount.toString())},[null==Q?void 0:Q.sendAmount]),(0,n.useEffect)(()=>{Q&&l("".concat(o).concat(o?".":"","to[0].amount"),Q.receiveAmount.toString())},[null==Q?void 0:Q.receiveAmount]);let Y=Q?Q.isLoading:B.isLoading||G.isLoading;return(0,s.jsxs)(u.x,{width:"full",children:[(0,s.jsxs)(u.x,{className:"z7liuav z7liuazp z7liua21 z7liuald z7liuat7 z7liuatb",children:[(0,s.jsx)(E.ZP,{name:"manifest",hidden:!0}),(0,s.jsx)(O.ZP,{name:"dex",placeholder:t.formatMessage($.dex),sizeVariant:"large",data:J,fullWidth:!0,disabled:B.isLoading||G.isLoading}),(0,s.jsx)(A.e,{placeholder:t.formatMessage($.account_placeholder),ref:r,name:"account"}),(0,s.jsx)(f.H,{name:"from",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(T.O,{balances:x,resourceAddresses:j,onAmountChange:()=>{R("send")}})}),(0,s.jsx)(f.H,{name:"to",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(T.O,{disabledAmount:(null==Q?void 0:Q.allowsReceive)===!1,balances:x,resourceAddresses:M,onAmountChange:()=>{R("receive")}})})]}),(0,s.jsx)(h.d,{message:null===(a=null==Q?void 0:Q.error)||void 0===a?void 0:a.message}),(Y||Q)&&(0,s.jsx)(u.x,{className:"z7liua1km z7liua1ks z7liua1ka z7liua1kg z7liua1ky z7liua1ld z7liua1ls z7liua1m7 z7liuahp z7liuajm z7liua3aa z7liuafs z7liuadp z7liualj z7liua1mu z7liua538",children:Y?(0,s.jsx)(k.hW,{}):Q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage($.price_impact)}),rightData:(0,s.jsx)(F.eE,{message:t.formatMessage($.price_impact_info),children:(0,s.jsx)(u.x,{children:(0,s.jsx)(L.Z,{size:"small",color:"strong",children:t.formatNumber(Q.priceImpact,K.Bp)})})})}),(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage($.fee_wallet)}),rightData:(0,s.jsxs)(L.Z,{size:"small",color:"strong",children:[t.formatNumber(q,K.i)," ",v]})}),(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage($.fee_lp)}),rightData:(0,s.jsxs)(L.Z,{size:"small",color:"strong",children:[t.formatNumber(Q.swapFee,K.i)," ",v]})})]})})]})};let Q=(0,r.vU)({button_add_swap:{id:"Clukea",defaultMessage:"Add another swap"},button_submit:{id:"s8BnAC",defaultMessage:"Swap"},validation_token_required:{id:"IXFNmv",defaultMessage:"Resource is required"},validation_token:{id:"gO3ocF",defaultMessage:"Please select token"},validation_amount_required:{id:"jU3fsF",defaultMessage:"Amount is required"},validation_amount:{id:"FrNeCi",defaultMessage:"Please enter a valid amount"},validation_account:{id:"w2XWRt",defaultMessage:"Please select account"},validation_swaps:{id:"WsQhkr",defaultMessage:"At least one action is required"},error_toast:{id:"fjqZcw",defaultMessage:"Failed submitting transaction to the network"},success_toast:{id:"Gkt0d0",defaultMessage:"Successfully submitted transaction to the network"},toast_action_label:{id:"K7AkdL",defaultMessage:"Show"}}),Y={swaps:[{dex:"",manifest:"",account:"",from:[{address:"",amount:0}],to:[{address:"",amount:0}]}]},ee=()=>{let e=(0,i.Z)(),a=(0,b.p)(),t=(0,l.TH)(),r=(0,l.s0)(),k=(0,j.h9)(),[w]=(0,o.lr)(),y=(0,M.z)(),{data:A}=(0,v.D)(),[O,E]=(0,n.useState)(Y),[T,N]=(0,n.useState)();(0,n.useEffect)(()=>{if(!A)return;let e=Object.keys(y);0!==e.length&&E({swaps:[{dex:"",manifest:"",account:e[0],from:[{address:A.resourceAddresses.xrd,amount:0}],to:[{address:1===k?"resource_rdx1t52pvtk5wfhltchwh3rkzls2x0r98fw9cjhpyrf3vsykhkuwrf7jg8":"",amount:0}]}]})},[k,y,A]);let S=(0,n.useMemo)(()=>{let a=d.z.object({address:d.z.string({required_error:e.formatMessage(Q.validation_token_required)}).min(1,e.formatMessage(Q.validation_token)),amount:d.z.coerce.number({required_error:e.formatMessage(Q.validation_amount_required)}).gt(0,{message:e.formatMessage(Q.validation_amount)})});return d.z.object({swaps:d.z.array(d.z.object({dex:d.z.literal("oci").or(d.z.literal(z)),manifest:d.z.string().min(1),account:d.z.string().min(1,e.formatMessage(Q.validation_account)),from:d.z.array(a).length(1),to:d.z.array(a).length(1)})).min(1,e.formatMessage(Q.validation_swaps))})},[]),C=async s=>{N(void 0);let n=S.safeParse(s);if(!1===n.success){N(n.error);return}let i=s.swaps.map(e=>e.manifest).join("\n");await a({version:1,transactionManifest:i}).then(a=>{c.A.success(e.formatMessage(Q.success_toast),{description:a.status,action:{label:e.formatMessage(Q.toast_action_label),onClick:()=>{w.set("tx","".concat(a.transactionIntentHash)),r("".concat(t.pathname,"?").concat(w))}}}),E(Y)}).catch(a=>{c.A.error(e.formatMessage(Q.error_toast),{description:a.message||a.error})})};return(0,s.jsx)(u.x,{width:"full",children:(0,s.jsxs)(m.l,{onSubmit:C,initialValues:O,errors:null==T?void 0:T.format(),className:"z7liua4",children:[(0,s.jsx)(u.x,{className:"z7liua4 z7liuav z7liuafp",children:(0,s.jsx)(h.d,{message:null==T?void 0:T.flatten().formErrors[0]})}),(0,s.jsx)(f.H,{name:"swaps",defaultKeys:1,addTrigger:(0,s.jsx)(u.x,{className:"z7liuady",children:(0,s.jsx)(x.z,{styleVariant:"secondary",sizeVariant:"large",fullWidth:!0,leftIcon:(0,s.jsx)(u.x,{marginLeft:"small",children:(0,s.jsx)(g.Z,{})}),children:e.formatMessage(Q.button_add_swap)})}),trashTrigger:(0,s.jsx)(u.x,{children:(0,s.jsx)(x.z,{styleVariant:"ghost",sizeVariant:"small",iconOnly:!0,children:(0,s.jsx)(_.Z,{})})}),className:"z7liua1ky z7liua1ld z7liua1ls z7liua1m7 z7liuav z7liuat1 z7liua1km z7liua3a3 z7liualm z7liuady",children:(0,s.jsx)(u.x,{paddingBottom:"small",children:(0,s.jsx)(J,{})})}),(0,s.jsx)(u.x,{className:"z7liua4 z7liuads",children:(0,s.jsx)(p.M,{children:(0,s.jsx)(x.z,{sizeVariant:"large",styleVariant:"primary",fullWidth:!0,children:e.formatMessage(Q.button_submit)})})})]})})};var ea=ee},52311:function(){}}]);