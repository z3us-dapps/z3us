(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1335],{72797:function(e,a,t){"use strict";t.d(a,{Hz:function(){return i}});var s=t(52322),n=t(2784),r=t(72580),o=t(9219);let i=(0,n.forwardRef)((e,a)=>{let{isPassword:t,onChange:n,hasError:o,styleVariant:i="primary",...c}=e;return(0,s.jsx)(r.I,{...c,styleVariant:o?"primary"===i?"primary-error":"secondary-error":i,type:t?"password":"text",ref:a,onChange:e=>{let a=e.nativeEvent;a.isComposing||n(e.target.value)}})}),c=(0,n.forwardRef)((e,a)=>{let{validate:t,name:n,label:r,isPassword:c,hidden:l,...d}=e;return(0,s.jsx)(o.n,{name:n,label:r,validate:t,hidden:l,children:(0,s.jsx)(i,{...d,isPassword:c,hidden:!0,ref:a})})});a.ZP=c},66568:function(e,a,t){"use strict";t.r(a),t.d(a,{Swap:function(){return Y},default:function(){return ee}});var s=t(52322),n=t(2784),r=t(49177),o=t(83112),i=t(73557),c=t(39857),l=t(8522),d=t(23554),u=t(18917),f=t(99040),m=t(36650),_=t(43207),p=t(68080),g=t(65098),x=t(86578),b=t(2827);let h="astrolecent";var v=t(7540),j=t(38059),M=t(86363),w=t(47843),k=t(12348),A=t(73452),y=t(12132),z=t(98076),O=t(97101),E=t(72797),T=t(5535),N=t(70440),S=t(50945),C=t(10455),F=t(28694),L=t(43789),P=t(26810),K=t(26494),R=t(29774),H=t(47324),Z=t(35305),D=t(91316),I=t(16803),W=t(57635),q=t(7101);let B=(e,a,t,s,r)=>{let{data:o}=(0,Z.pH)(t),[i,c]=(0,n.useState)(r>0),[l,d]=(0,n.useState)(""),[u,f]=(0,n.useState)(0),[m,_]=(0,n.useState)(0),{data:p,error:g,isFetching:x}=(0,D.G_)(e,a,t,s,r),b=e=>{let{divisibility:a}=e;"send"===s?(f(r),_(.997*p.outputTokens)):(f(p.inputTokens),_(r));let n=(0,q.O)(),o='\n			TAKE_FROM_WORKTOP\n				Address("'.concat(t,'")\n				Decimal("').concat((.003*p.outputTokens).toFixed(a),'")\n				Bucket("fee_bucket').concat(n,'")\n			;\n			CALL_METHOD\n				Address("').concat(W.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(n,'")\n				Enum<0u8>()\n			;\n		'),i=p.manifest.lastIndexOf("CALL_METHOD"),c="".concat(p.manifest.substring(0,i),"\n").concat(o,"\n").concat(p.manifest.substring(i));d(c)};return(0,n.useEffect)(()=>{if(x){c(!0);return}o&&(d(""),p?(b(o.details),c(!1)):g&&c(!1))},[e,t,o,x,p,g]),{dex:h,allowsReceive:!1,isLoading:i,error:g,manifest:l,sendAmount:u,receiveAmount:m,price:m>0?u/m:0,priceImpact:(null==p?void 0:p.priceImpact)||0,swapFee:(null==p?void 0:p.swapFee)||0}};var V=t(84192);let U=(e,a,t,s,r)=>{let{data:o}=(0,Z.pH)(t),{data:i,error:c,isFetching:l}=(0,V.G_)(a,t,s,r),[d,u]=(0,n.useState)(r>0),[f,m]=(0,n.useState)(""),[_,p]=(0,n.useState)(0),[g,x]=(0,n.useState)(0),b=t=>{let{divisibility:s}=t,n=i.input_address===a?"send":"receive",o="send"===n?"input":"output",c="send"===n?"output":"input";"send"===n?(p(r),x(.997*Number.parseFloat(i["".concat(c,"_amount")].token))):(p(Number.parseFloat(i["".concat(o,"_amount")].token)),x(r));let l=(0,q.O)(),d=i.swaps.reduce((a,t)=>"\n		".concat(a,'\n			CALL_METHOD\n				Address("').concat(e,'")\n				"withdraw"\n				Address("').concat(t["".concat(o,"_address")],'")\n				Decimal("').concat(t["".concat(o,"_amount")].token,'")\n			;\n			TAKE_ALL_FROM_WORKTOP\n				Address("').concat(t["".concat(o,"_address")],'")\n				Bucket("bucket').concat(l,'")\n			;\n			CALL_METHOD\n				Address("').concat(t.pool_address,'")\n				"swap"\n				Bucket("bucket').concat(l,'")\n			;\n			TAKE_FROM_WORKTOP\n				Address("').concat(t["".concat(c,"_address")],'")\n				Decimal("').concat((.003*Number.parseFloat(t["".concat(c,"_amount")].token)).toFixed(s),'")\n				Bucket("fee_bucket').concat(l,'")\n			;\n			CALL_METHOD\n				Address("').concat(W.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(l,'")\n				Enum<0u8>()\n			;\n			CALL_METHOD\n				Address("').concat(e,'")\n				"deposit_batch"\n				Expression("ENTIRE_WORKTOP")\n			;\n		'),"");m(d)};return(0,n.useEffect)(()=>{if(l){u(!0);return}o&&(m(""),i?(b(o.details),u(!1)):c&&u(!1))},[e,a,o,l,i,c]),{dex:"oci",allowsReceive:!0,isLoading:d,error:c,manifest:f,sendAmount:_,receiveAmount:g,price:g>0?_/g:0,priceImpact:i?Number.parseFloat(i.price_impact):0,swapFee:i?Number.parseFloat(i.input_fee_lp.token):0}};t(41486),t(8144),t(39986),t(52311);let G={oci:R.l.OCI_SWAP,[h]:R.l.ASTROLESCENT},X=(0,r.vU)({fee_wallet:{id:"PyXtpD",defaultMessage:"Wallet fee"},fee_lp:{id:"OS5a2i",defaultMessage:"Pool fee"},price_impact:{id:"WBB92z",defaultMessage:"Price impact"},price_impact_info:{id:"MoWYiJ",defaultMessage:"Price impact is the influence of user&apos;s individual trade over the market price of an underlying asset pair. It is directly correlated with the amount of liquidity in the pool. Price impact can be especially high for illiquid markets/pairs, and may cause a trader to lose a significant portion of their funds."},account_placeholder:{defaultMessage:"Select account",id:"0+6+jP"},swap_lading_error:{defaultMessage:"Swap preview is loading...",id:"dgs4z4"},dex:{id:"ifOb7y",defaultMessage:"Dex"},dex_oci:{id:"eyMKyf",defaultMessage:"OCI"},dex_astrolecent:{id:"CrAj8T",defaultMessage:"Astrolecent"}});var $=()=>{var e,a;let t=(0,o.Z)(),r=(0,n.useRef)(null),{onFieldChange:i}=(0,n.useContext)(A.q),{name:c}=(0,n.useContext)(y.z),l=(0,N.K)("".concat(c?"".concat(c,"."):"","dex")),d=(0,N.K)("".concat(c?"".concat(c,"."):"","account"))||"",f=(0,N.K)("".concat(c).concat(c?".":"","from[0]")),_=(0,N.K)("".concat(c).concat(c?".":"","to[0]")),{data:p}=(0,D.rU)(),{data:g}=(0,Z.pH)(null==_?void 0:_.address),{fungibleBalances:x=[]}=(0,H.ln)([d]),v=(0,I.vK)("symbol",null==g?void 0:null===(e=g.metadata)||void 0===e?void 0:e.items),j=(0,n.useMemo)(()=>x.filter(e=>!!(null==p?void 0:p[e.address])).map(e=>e.address),[x,p]),M=(0,n.useMemo)(()=>Object.keys(p||{}),[p]),[w,R]=(0,n.useState)("send"),W=(0,n.useMemo)(()=>"send"===w?Number.parseFloat((null==f?void 0:f.amount)||"0"):Number.parseFloat((null==_?void 0:_.amount)||"0"),[w,f,_]),q=(0,n.useMemo)(()=>.003*Number.parseFloat((null==_?void 0:_.amount)||"0"),[null==_?void 0:_.amount]),V=U(d,null==f?void 0:f.address,null==_?void 0:_.address,w,W),$=B(d,null==f?void 0:f.address,null==_?void 0:_.address,w,W);(0,n.useEffect)(()=>{var e;null==r||null===(e=r.current)||void 0===e||e.focus()},[null==r?void 0:r.current]);let J=(0,n.useMemo)(()=>{let e={oci:V,[h]:$},a=Object.keys(e).sort((a,t)=>e[a].price-e[t].price);return a.map((n,r)=>({id:n,title:(0,s.jsxs)(u.x,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"small",children:[(0,s.jsxs)(u.x,{paddingLeft:"small",display:"flex",alignItems:"center",gap:"small",children:[(0,s.jsx)(C.H,{size:"small",address:G[n]}),(0,s.jsx)(L.Z,{children:t.formatMessage(X["dex_".concat(n)])})]}),r>0&&e[n].price>0&&(0,s.jsx)(P.Z,{size:"large",change:0===r?1:-1,children:t.formatNumber((e[a[0]].price-e[n].price)/e[n].price,K.Bp)})]})}))},[V,$]);(0,n.useEffect)(()=>{l||""===V.manifest||""===$.manifest||(V.error?i("".concat(c).concat(c?".":"","dex"),h):$.error?i("".concat(c).concat(c?".":"","dex"),"oci"):i("".concat(c).concat(c?".":"","dex"),V.price>$.price?h:"oci"))},[V.manifest,V.error,V.sendAmount,V.receiveAmount,$.manifest,$.error,$.sendAmount,$.receiveAmount]);let Q=(0,n.useMemo)(()=>{switch(l){case"oci":return V;case h:return $;default:return null}},[l,V,$]);(0,n.useEffect)(()=>{Q&&i("".concat(c).concat(c?".":"","manifest"),Q.manifest)},[null==Q?void 0:Q.manifest]),(0,n.useEffect)(()=>{Q&&i("".concat(c).concat(c?".":"","from[0].amount"),Q.sendAmount.toString())},[null==Q?void 0:Q.sendAmount]),(0,n.useEffect)(()=>{Q&&i("".concat(c).concat(c?".":"","to[0].amount"),Q.receiveAmount.toString())},[null==Q?void 0:Q.receiveAmount]);let Y=Q?Q.isLoading:V.isLoading||$.isLoading;return(0,s.jsxs)(u.x,{width:"full",children:[(0,s.jsxs)(u.x,{className:"x3la7g8 _5baftfg _5baftfeg _5baftf17 _5baftf87 _5baftf2v _5baftf2z",children:[(0,s.jsx)(E.ZP,{name:"manifest",hidden:!0}),(0,s.jsx)(O.ZP,{name:"dex",placeholder:t.formatMessage(X.dex),sizeVariant:"large",data:J,fullWidth:!0,disabled:V.isLoading||$.isLoading}),(0,s.jsx)(z.e,{placeholder:t.formatMessage(X.account_placeholder),ref:r,name:"account"}),(0,s.jsx)(m.H,{name:"from",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(T.O,{balances:x,resourceAddresses:j,onAmountChange:()=>{R("send")}})}),(0,s.jsx)(m.H,{name:"to",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(T.O,{disabledAmount:(null==Q?void 0:Q.allowsReceive)===!1,balances:x,resourceAddresses:M,onAmountChange:()=>{R("receive")}})})]}),(0,s.jsx)(b.d,{message:null===(a=null==Q?void 0:Q.error)||void 0===a?void 0:a.message}),(Y||Q)&&(0,s.jsx)(u.x,{className:"x3la7gg _5baftf3d _5baftf3j _5baftf3p _5baftf3v _5baftf3y _5baftf44 _5baftf4a _5baftf4g _5baftf6p _5baftf7j _5baftf3rr _5baftf5v _5baftf4v _5baftf8d _5baftfgn _5baftf14h",children:Y?(0,s.jsx)(k.hW,{}):Q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage(X.price_impact)}),rightData:(0,s.jsx)(F.eE,{message:t.formatMessage(X.price_impact_info),children:(0,s.jsx)(u.x,{children:(0,s.jsx)(L.Z,{size:"small",color:"strong",children:t.formatNumber(Q.priceImpact,K.Bp)})})})}),(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage(X.fee_wallet)}),rightData:(0,s.jsxs)(L.Z,{size:"small",color:"strong",children:[t.formatNumber(q,K.i)," ",v]})}),(0,s.jsx)(S.$,{leftTitle:(0,s.jsx)(L.Z,{size:"small",children:t.formatMessage(X.fee_lp)}),rightData:(0,s.jsxs)(L.Z,{size:"small",color:"strong",children:[t.formatNumber(Q.swapFee,K.i)," ",v]})})]})})]})};let J=(0,r.vU)({button_add_swap:{id:"Clukea",defaultMessage:"Add another swap"},button_submit:{id:"s8BnAC",defaultMessage:"Swap"},validation_token_required:{id:"IXFNmv",defaultMessage:"Resource is required"},validation_token:{id:"gO3ocF",defaultMessage:"Please select token"},validation_amount_required:{id:"jU3fsF",defaultMessage:"Amount is required"},validation_amount:{id:"FrNeCi",defaultMessage:"Please enter a valid amount"},validation_account:{id:"w2XWRt",defaultMessage:"Please select account"},validation_swaps:{id:"WsQhkr",defaultMessage:"At least one action is required"},error_toast:{id:"fjqZcw",defaultMessage:"Failed submitting transaction to the network"},success_toast:{id:"Gkt0d0",defaultMessage:"Successfully submitted transaction to the network"},toast_action_label:{id:"K7AkdL",defaultMessage:"Show"}}),Q={swaps:[{dex:"",manifest:"",account:"",from:[{address:"",amount:0}],to:[{address:"",amount:0}]}]},Y=()=>{let e=(0,o.Z)(),a=(0,w.p)(),t=(0,i.TH)(),r=(0,i.s0)(),k=(0,j.h9)(),[A]=(0,c.lr)(),y=(0,M.z)(),{data:z}=(0,v.D)(),[O,E]=(0,n.useState)(Q),[T,N]=(0,n.useState)();(0,n.useEffect)(()=>{if(!z)return;let e=Object.keys(y);0!==e.length&&E({swaps:[{dex:"",manifest:"",account:e[0],from:[{address:z.resourceAddresses.xrd,amount:0}],to:[{address:1===k?"resource_rdx1t52pvtk5wfhltchwh3rkzls2x0r98fw9cjhpyrf3vsykhkuwrf7jg8":"",amount:0}]}]})},[k,y,z]);let S=(0,n.useMemo)(()=>{let a=d.z.object({address:d.z.string({required_error:e.formatMessage(J.validation_token_required)}).min(1,e.formatMessage(J.validation_token)),amount:d.z.coerce.number({required_error:e.formatMessage(J.validation_amount_required)}).gt(0,{message:e.formatMessage(J.validation_amount)})});return d.z.object({swaps:d.z.array(d.z.object({dex:d.z.literal("oci").or(d.z.literal(h)),manifest:d.z.string().min(1),account:d.z.string().min(1,e.formatMessage(J.validation_account)),from:d.z.array(a).length(1),to:d.z.array(a).length(1)})).min(1,e.formatMessage(J.validation_swaps))})},[]),C=async s=>{N(void 0);let n=S.safeParse(s);if(!1===n.success){N(n.error);return}let o=s.swaps.map(e=>e.manifest).join("\n");await a({version:1,transactionManifest:o}).then(a=>{l.A.success(e.formatMessage(J.success_toast),{description:a.status,action:{label:e.formatMessage(J.toast_action_label),onClick:()=>{A.set("tx","".concat(a.transactionIntentHash)),r("".concat(t.pathname,"?").concat(A))}}}),E(Q)}).catch(a=>{l.A.error(e.formatMessage(J.error_toast),{description:a.message||a.error})})};return(0,s.jsx)(u.x,{width:"full",children:(0,s.jsxs)(f.l,{onSubmit:C,initialValues:O,errors:null==T?void 0:T.format(),className:"x3la7ga _5baftf4",children:[(0,s.jsx)(u.x,{className:"x3la7g6 _5baftf4 _5baftfg _5baftf5s",children:(0,s.jsx)(b.d,{message:null==T?void 0:T.flatten().formErrors[0]})}),(0,s.jsx)(m.H,{name:"swaps",defaultKeys:1,addTrigger:(0,s.jsx)(u.x,{className:"x3la7ge _5baftf54",children:(0,s.jsx)(x.z,{styleVariant:"secondary",sizeVariant:"large",fullWidth:!0,leftIcon:(0,s.jsx)(u.x,{marginLeft:"small",children:(0,s.jsx)(p.Z,{})}),children:e.formatMessage(J.button_add_swap)})}),trashTrigger:(0,s.jsx)(u.x,{children:(0,s.jsx)(x.z,{styleVariant:"ghost",sizeVariant:"small",iconOnly:!0,children:(0,s.jsx)(g.Z,{})})}),className:"x3la7gc _5baftf3y _5baftf44 _5baftf4a _5baftf4g _5baftfg _5baftf2p _5baftf3d _5baftf3rk _5baftf8g _5baftf54",children:(0,s.jsx)(u.x,{paddingBottom:"small",children:(0,s.jsx)($,{})})}),(0,s.jsx)(u.x,{className:"x3la7g2 _5baftf4 _5baftf4y",children:(0,s.jsx)(_.M,{children:(0,s.jsx)(x.z,{sizeVariant:"large",styleVariant:"primary",fullWidth:!0,children:e.formatMessage(J.button_submit)})})})]})})};var ee=Y},52311:function(){}}]);