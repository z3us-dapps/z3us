"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1573],{43047:function(e,t,a){a.r(t),a.d(t,{Swap:function(){return C},default:function(){return F}});var s=a(52322),r=a(2784),n=a(49177),o=a(83112),i=a(73557),c=a(39857),l=a(8522),d=a(23554),u=a(18917),m=a(99040),f=a(50945),_=a(28694),g=a(43789),p=a(2827),h=a(26494),M=a(68284),x=a(84192),b=a(47843),j=a(16803),v=a(6887),k=a(12132),y=a(95886),w=a(98076),z=a(43207),A=a(5535),E=a(70440),N=a(47324);let O=(0,n.vU)({account_placeholder:{defaultMessage:"Select account",id:"0+6+jP"},button_submit:{id:"s8BnAC",defaultMessage:"Swap"}});var T=()=>{let e=(0,o.Z)(),t=(0,r.useRef)(null),{name:a}=(0,r.useContext)(k.z),n=(0,E.K)("".concat(a?"".concat(a,"."):"","account"))||"",{data:i}=(0,x.rU)(),{data:c}=(0,N.ln)(n),{fungibleBalances:l=[]}=c||{},d=(0,r.useMemo)(()=>l.filter(e=>!!i[e.address]).map(e=>e.address),[c,i]),m=(0,r.useMemo)(()=>Object.keys(i),[i]);return(0,r.useEffect)(()=>{var e;null==t||null===(e=t.current)||void 0===e||e.focus()},[null==t?void 0:t.current]),(0,s.jsxs)(u.x,{display:"flex",flexDirection:"column",gap:"medium",alignItems:"center",justifyContent:"center",children:[(0,s.jsx)(w.e,{placeholder:e.formatMessage(O.account_placeholder),ref:t,name:"account"}),(0,s.jsx)(y.H,{name:"from",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(A.O,{balances:l,resourceAddresses:d})}),(0,s.jsx)(y.H,{name:"to",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(A.O,{balances:l,resourceAddresses:m})}),(0,s.jsx)(z.M,{children:(0,s.jsx)(v.z,{sizeVariant:"large",styleVariant:"primary",fullWidth:!0,children:e.formatMessage(O.button_submit)})})]})};let P=(0,n.vU)({fee_wallet:{id:"PyXtpD",defaultMessage:"Wallet fee"},fee_lp:{id:"OS5a2i",defaultMessage:"Pool fee"},price_impact:{id:"WBB92z",defaultMessage:"Price impact"},price_impact_info:{id:"MoWYiJ",defaultMessage:"Price impact is the influence of user&apos;s individual trade over the market price of an underlying asset pair. It is directly correlated with the amount of liquidity in the pool. Price impact can be especially high for illiquid markets/pairs, and may cause a trader to lose a significant portion of their funds."},validation_token_required:{id:"IXFNmv",defaultMessage:"Resource is required"},validation_token:{id:"gO3ocF",defaultMessage:"Please select token"},validation_amount_required:{id:"jU3fsF",defaultMessage:"Amount is required"},validation_amount:{id:"FrNeCi",defaultMessage:"Please enter a valid amount"},validation_account:{id:"w2XWRt",defaultMessage:"Please select account"},error_toast:{id:"fjqZcw",defaultMessage:"Failed submitting transaction to the network"},success_toast:{id:"Gkt0d0",defaultMessage:"Successfully submitted transaction to the network"},toast_action_label:{id:"K7AkdL",defaultMessage:"Show"}}),S={account:"",from:[{address:"",amount:0}],to:[{address:"",amount:0}]};function q(e,t){let a=e.to[0].amount!==t.to[0].amount?"receive":"send",s="send"===a?t.from[0].amount:t.to[0].amount,r=.003*s;return{from:t.from[0].address,to:t.to[0].address,side:a,amount:s+r,fee:r}}let C=()=>{let e=(0,o.Z)(),t=(0,b.p)(),a=(0,i.TH)(),n=(0,i.s0)(),[v]=(0,c.lr)(),[k,y]=(0,r.useState)(S),[w,z]=(0,r.useState)(S),[A,E]=(0,r.useState)(q(k,k)),[N,O]=(0,r.useState)(),{data:C,error:F}=(0,x.G_)(A.from,A.to,A.side,A.amount),{data:D}=(0,M.S)(A.from),L=(0,j.vK)("symbol",D);(0,r.useEffect)(()=>{if(!C)return;let e=function(e,t,a){let s="send"===e.side?"input":"output",r="send"===e.side?"output":"input";return{account:t.account,from:[{address:a["".concat(s,"_address")],amount:Number.parseFloat(a["".concat(s,"_amount")].token)}],to:[{address:a["".concat(r,"_address")],amount:Number.parseFloat(a["".concat(r,"_amount")].token)}]}}(A,w,C);z(e),y(e)},[C]);let Z=(0,r.useMemo)(()=>{let t=d.z.object({address:d.z.string({required_error:e.formatMessage(P.validation_token_required)}).min(1,e.formatMessage(P.validation_token)),amount:d.z.coerce.number({required_error:e.formatMessage(P.validation_amount_required)}).gt(0,{message:e.formatMessage(P.validation_amount)})});return d.z.object({account:d.z.string().min(1,e.formatMessage(P.validation_account)),from:d.z.array(t).length(1),to:d.z.array(t).length(1)})},[]),K=async e=>{(w.from[0].address!==e.from[0].address||w.from[0].amount!==e.from[0].amount||w.to[0].address!==e.to[0].address||w.to[0].amount!==e.to[0].amount)&&(E(q(w,e)),z(e))},H=async s=>{O(void 0);let r=Z.safeParse(s);if(!1===r.success){O(r.error);return}let o="send"===A.side?"input":"output",i=C.swaps.reduce((e,t)=>"\n		".concat(e,'\n			CALL_METHOD\n				Address("').concat(s.account,'")\n				"withdraw"\n				Address("').concat(t["".concat(o,"_address")],'")\n				Decimal("').concat(1.003*Number.parseFloat(t["".concat(o,"_amount")].token),'")\n			;\n			TAKE_ALL_FROM_WORKTOP\n				Address("').concat(t["".concat(o,"_address")],'")\n				Bucket("bucket1")\n			;\n			CALL_METHOD\n				Address("').concat(t.pool_address,'")\n				"swap"\n				Bucket("bucket1")\n			;\n			CALL_METHOD\n				Address("').concat(s.account,'")\n				"deposit_batch"\n				Expression("ENTIRE_WORKTOP")\n			;\n		'),"");await t({version:1,transactionManifest:i}).then(t=>{l.A.success(e.formatMessage(P.success_toast),{description:t.status,action:{label:e.formatMessage(P.toast_action_label),onClick:()=>{v.set("tx","".concat(t.transactionIntentHash)),n("".concat(a.pathname,"?").concat(v))}}}),y(S)}).catch(t=>{l.A.error(e.formatMessage(P.error_toast),{description:t.message||t.error})})};return(0,s.jsx)(u.x,{width:"full",children:(0,s.jsxs)(m.l,{onSubmit:H,onChange:K,initialValues:k,errors:null==N?void 0:N.format(),children:[(0,s.jsx)(p.d,{message:(null==N?void 0:N.flatten().formErrors[0])||(null==F?void 0:F.message)}),(0,s.jsx)(T,{}),C&&(0,s.jsxs)(u.x,{children:[(0,s.jsx)(f.$,{leftTitle:(0,s.jsx)(g.Z,{size:"small",children:e.formatMessage(P.price_impact)}),rightData:(0,s.jsx)(_.eE,{message:e.formatMessage(P.price_impact_info),children:(0,s.jsx)(u.x,{children:(0,s.jsx)(g.Z,{size:"small",color:"strong",children:e.formatNumber(Number.parseFloat(C.price_impact),h.Bp)})})})}),(0,s.jsx)(f.$,{leftTitle:(0,s.jsx)(g.Z,{size:"small",children:e.formatMessage(P.fee_wallet)}),rightData:(0,s.jsxs)(g.Z,{size:"small",color:"strong",children:[e.formatNumber(A.fee,h.i)," ",L]})}),(0,s.jsx)(f.$,{leftTitle:(0,s.jsx)(g.Z,{size:"small",children:e.formatMessage(P.fee_lp)}),rightData:(0,s.jsxs)(g.Z,{size:"small",color:"strong",children:[e.formatNumber(Number.parseFloat(C.input_fee_lp.token),h.i)," ",L]})})]})]})})};var F=C}}]);