(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3020],{72797:function(e,a,t){"use strict";t.d(a,{Hz:function(){return o}});var s=t(52322),n=t(2784),r=t(72580),i=t(9219);let o=(0,n.forwardRef)((e,a)=>{let{isPassword:t,onChange:n,hasError:i,styleVariant:o="primary",...l}=e;return(0,s.jsx)(r.I,{...l,styleVariant:i?"primary"===o?"primary-error":"secondary-error":o,type:t?"password":"text",ref:a,onChange:e=>{let a=e.nativeEvent;a.isComposing||n(e.target.value)}})}),l=(0,n.forwardRef)((e,a)=>{let{validate:t,name:n,label:r,isPassword:l,hidden:c,...d}=e;return(0,s.jsx)(i.n,{name:n,label:r,validate:t,hidden:c,children:(0,s.jsx)(o,{...d,isPassword:l,hidden:!0,ref:a})})});a.ZP=l},43645:function(e,a,t){"use strict";t.r(a),t.d(a,{Swap:function(){return es},default:function(){return en}});var s=t(52322),n=t(2784),r=t(49177),i=t(83112),o=t(73557),l=t(39857),c=t(8522),d=t(23554),u=t(18917),f=t(99040),m=t(36650),_=t(43207),g=t(68080),x=t(65098),h=t(86578),p=t(2827),b=t(7540),j=t(38059),v=t(86363),M=t(47843),y=t(6277),k=t(86232),w=t(10455),z=t(13154),A=t(43789),O=t(29774),N=t(12348),T=t(73452),E=t(12132),P=t(98076),Z=t(72797),C=t(5535),F=t(70440),K=t(50945),S=t(28694),H=t(57635),L=t(26494),D=t(47324),W=t(35305),q=t(91316),R=t(16803),B=t(7101);t(41486),t(8144),t(9563),t(52311);var I="x3la7gg _5baftf3a _5baftf3g _5baftf3m _5baftf3s _5baftf3v _5baftf41 _5baftf47 _5baftf4d _5baftf6m _5baftf7g _5baftf3ro _5baftf5s _5baftf4s _5baftf8a _5baftfgk _5baftf14e",V="x3la7g8 _5baftfg _5baftfed _5baftf14 _5baftf84 _5baftf2s _5baftf2w";let U=(0,r.vU)({fee_wallet:{id:"PyXtpD",defaultMessage:"Wallet fee"},fee_lp:{id:"OS5a2i",defaultMessage:"Pool fee"},price_impact:{id:"WBB92z",defaultMessage:"Price impact"},price_impact_info:{id:"MoWYiJ",defaultMessage:"Price impact is the influence of user&apos;s individual trade over the market price of an underlying asset pair. It is directly correlated with the amount of liquidity in the pool. Price impact can be especially high for illiquid markets/pairs, and may cause a trader to lose a significant portion of their funds."},account_placeholder:{defaultMessage:"Select account",id:"0+6+jP"},swap_lading_error:{defaultMessage:"Swap preview is loading...",id:"dgs4z4"}}),$=()=>{var e;let a=(0,i.Z)(),t=(0,n.useRef)(null),{onFieldChange:r}=(0,n.useContext)(T.q),{name:o}=(0,n.useContext)(E.z),l=(0,F.K)("".concat(o?"".concat(o,"."):"","account"))||"",c=(0,F.K)("".concat(o).concat(o?".":"","from[0]")),d=(0,F.K)("".concat(o).concat(o?".":"","to[0]")),{data:f={}}=(0,q.rU)(),{data:_}=(0,W.pH)(null==d?void 0:d.address),{fungibleBalances:g=[]}=(0,D.ln)([l]),x=(0,R.vK)("symbol",null==_?void 0:null===(e=_.metadata)||void 0===e?void 0:e.items),h=(0,n.useMemo)(()=>g.filter(e=>!!f[e.address]).map(e=>e.address),[g,f]),b=(0,n.useMemo)(()=>Object.keys(f),[f]),[j,v]=(0,n.useState)("send"),M=(0,n.useMemo)(()=>"send"===j?Number.parseFloat((null==c?void 0:c.amount)||"0"):Number.parseFloat((null==d?void 0:d.amount)||"0"),[j,c,d]),y=(0,n.useMemo)(()=>.003*Number.parseFloat((null==d?void 0:d.amount)||"0"),[null==d?void 0:d.amount]),{data:k,error:w,isFetching:z}=(0,q.G_)(l,null==c?void 0:c.address,null==d?void 0:d.address,j,M);return(0,n.useEffect)(()=>{var e;null==t||null===(e=t.current)||void 0===e||e.focus()},[null==t?void 0:t.current]),(0,n.useEffect)(()=>{r("".concat(o).concat(o?".":"","dex"),"astrolecent")},[r]),(0,n.useEffect)(()=>{z&&r("".concat(o).concat(o?".":"","manifest"),"")},[z]),(0,n.useEffect)(()=>{if(!k)return;"send"===j?r("".concat(o).concat(o?".":"","to[0].amount"),(.997*k.outputTokens).toString()):r("".concat(o).concat(o?".":"","from[0].amount"),k.inputTokens.toString());let{divisibility:e}=_.details,a=(0,B.O)(),t='\n			TAKE_FROM_WORKTOP\n				Address("'.concat(d.address,'")\n				Decimal("').concat((.003*k.outputTokens).toFixed(e),'")\n				Bucket("fee_bucket').concat(a,'")\n			;\n			CALL_METHOD\n				Address("').concat(H.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(a,'")\n				Enum<0u8>()\n			;\n		'),s=k.manifest.lastIndexOf("CALL_METHOD"),n="".concat(k.manifest.substring(0,s),"\n").concat(t,"\n").concat(k.manifest.substring(s));r("".concat(o).concat(o?".":"","manifest"),n)},[k]),(0,s.jsxs)(u.x,{width:"full",children:[(0,s.jsxs)(u.x,{className:V,children:[(0,s.jsx)(Z.ZP,{name:"dex",hidden:!0}),(0,s.jsx)(Z.ZP,{name:"manifest",hidden:!0}),(0,s.jsx)(P.e,{placeholder:a.formatMessage(U.account_placeholder),ref:t,name:"account"}),(0,s.jsx)(m.H,{name:"from",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(C.O,{balances:g,resourceAddresses:h,onAmountChange:()=>{v("send")}})}),(0,s.jsx)(m.H,{name:"to",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(C.O,{disabledAmount:!0,balances:g,resourceAddresses:b,onAmountChange:()=>{v("receive")}})})]}),(0,s.jsx)(p.d,{message:null==w?void 0:w.message}),(z||k)&&(0,s.jsxs)(u.x,{className:I,children:[z&&(0,s.jsx)(N.hW,{}),!z&&k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(U.price_impact)}),rightData:(0,s.jsx)(S.eE,{message:a.formatMessage(U.price_impact_info),children:(0,s.jsx)(u.x,{children:(0,s.jsx)(A.Z,{size:"small",color:"strong",children:a.formatNumber(k.priceImpact,L.Bp)})})})}),(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(U.fee_wallet)}),rightData:(0,s.jsxs)(A.Z,{size:"small",color:"strong",children:[a.formatNumber(y,L.i)," ",x]})}),(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(U.fee_lp)}),rightData:(0,s.jsxs)(A.Z,{size:"small",color:"strong",children:[a.formatNumber(k.swapFee,L.i)," ",x]})})]})]})]})};var X=t(84192);let G=(0,r.vU)({fee_wallet:{id:"PyXtpD",defaultMessage:"Wallet fee"},fee_lp:{id:"OS5a2i",defaultMessage:"Pool fee"},price_impact:{id:"WBB92z",defaultMessage:"Price impact"},price_impact_info:{id:"MoWYiJ",defaultMessage:"Price impact is the influence of user&apos;s individual trade over the market price of an underlying asset pair. It is directly correlated with the amount of liquidity in the pool. Price impact can be especially high for illiquid markets/pairs, and may cause a trader to lose a significant portion of their funds."},account_placeholder:{defaultMessage:"Select account",id:"0+6+jP"}}),J=()=>{var e;let a=(0,i.Z)(),t=(0,n.useRef)(null),{onFieldChange:r}=(0,n.useContext)(T.q),{name:o}=(0,n.useContext)(E.z),l=(0,F.K)("".concat(o?"".concat(o,"."):"","account"))||"",c=(0,F.K)("".concat(o).concat(o?".":"","from[0]")),d=(0,F.K)("".concat(o).concat(o?".":"","to[0]")),{data:f={}}=(0,X.rU)(),{data:_}=(0,W.pH)(null==d?void 0:d.address),{fungibleBalances:g=[]}=(0,D.ln)([l]),x=(0,R.vK)("symbol",null==_?void 0:null===(e=_.metadata)||void 0===e?void 0:e.items),h=(0,n.useMemo)(()=>g.filter(e=>!!f[e.address]).map(e=>e.address),[g,f]),b=(0,n.useMemo)(()=>Object.keys(f),[f]),[j,v]=(0,n.useState)("send"),M=(0,n.useMemo)(()=>"send"===j?Number.parseFloat((null==c?void 0:c.amount)||"0"):Number.parseFloat((null==d?void 0:d.amount)||"0"),[j,c,d]),y=(0,n.useMemo)(()=>.003*Number.parseFloat((null==d?void 0:d.amount)||"0"),[null==d?void 0:d.amount]),{data:k,error:w,isFetching:z}=(0,X.G_)(null==c?void 0:c.address,null==d?void 0:d.address,j,M);return(0,n.useEffect)(()=>{var e;null==t||null===(e=t.current)||void 0===e||e.focus()},[null==t?void 0:t.current]),(0,n.useEffect)(()=>{r("".concat(o).concat(o?".":"","dex"),"oci")},[]),(0,n.useEffect)(()=>{z&&r("".concat(o).concat(o?".":"","manifest"),"")},[z]),(0,n.useEffect)(()=>{if(!k)return;let e=k.input_address===(null==c?void 0:c.address)?"send":"receive",a="send"===e?"input":"output",t="send"===e?"output":"input";"send"===e?r("".concat(o).concat(o?".":"","to[0].amount"),(.997*Number.parseFloat(k["".concat(t,"_amount")].token)).toString()):r("".concat(o).concat(o?".":"","from[0].amount"),k["".concat(a,"_amount")].token);let{divisibility:s}=_.details,n=(0,B.O)(),i=k.swaps.reduce((e,r)=>"\n		".concat(e,'\n			CALL_METHOD\n				Address("').concat(l,'")\n				"withdraw"\n				Address("').concat(r["".concat(a,"_address")],'")\n				Decimal("').concat(r["".concat(a,"_amount")].token,'")\n			;\n			TAKE_ALL_FROM_WORKTOP\n				Address("').concat(r["".concat(a,"_address")],'")\n				Bucket("bucket').concat(n,'")\n			;\n			CALL_METHOD\n				Address("').concat(r.pool_address,'")\n				"swap"\n				Bucket("bucket').concat(n,'")\n			;\n			TAKE_FROM_WORKTOP\n				Address("').concat(r["".concat(t,"_address")],'")\n				Decimal("').concat((.003*Number.parseFloat(r["".concat(t,"_amount")].token)).toFixed(s),'")\n				Bucket("fee_bucket').concat(n,'")\n			;\n			CALL_METHOD\n				Address("').concat(H.Pz,'")\n				"try_deposit_or_abort"\n				Bucket("fee_bucket').concat(n,'")\n				Enum<0u8>()\n			;\n			CALL_METHOD\n				Address("').concat(l,'")\n				"deposit_batch"\n				Expression("ENTIRE_WORKTOP")\n			;\n		'),"");r("".concat(o).concat(o?".":"","manifest"),i)},[k]),(0,s.jsxs)(u.x,{width:"full",children:[(0,s.jsxs)(u.x,{className:V,children:[(0,s.jsx)(Z.ZP,{name:"dex",hidden:!0}),(0,s.jsx)(Z.ZP,{name:"manifest",hidden:!0}),(0,s.jsx)(P.e,{placeholder:a.formatMessage(G.account_placeholder),ref:t,name:"account"}),(0,s.jsx)(m.H,{name:"from",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(C.O,{balances:g,resourceAddresses:h,onAmountChange:()=>{v("send")}})}),(0,s.jsx)(m.H,{name:"to",defaultKeys:1,ignoreTriggers:!0,children:(0,s.jsx)(C.O,{balances:g,resourceAddresses:b,onAmountChange:()=>{v("receive")}})})]}),(0,s.jsx)(p.d,{message:null==w?void 0:w.message}),(z||k)&&(0,s.jsxs)(u.x,{className:I,children:[z&&(0,s.jsx)(N.hW,{}),!z&&k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(G.price_impact)}),rightData:(0,s.jsx)(S.eE,{message:a.formatMessage(G.price_impact_info),children:(0,s.jsx)(u.x,{children:(0,s.jsx)(A.Z,{size:"small",color:"strong",children:a.formatNumber(Number.parseFloat(k.price_impact),L.Bp)})})})}),(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(G.fee_wallet)}),rightData:(0,s.jsxs)(A.Z,{size:"small",color:"strong",children:[a.formatNumber(y,L.i)," ",x]})}),(0,s.jsx)(K.$,{leftTitle:(0,s.jsx)(A.Z,{size:"small",children:a.formatMessage(G.fee_lp)}),rightData:(0,s.jsxs)(A.Z,{size:"small",color:"strong",children:[a.formatNumber(Number.parseFloat(k.input_fee_lp.token),L.i)," ",x]})})]})]})]})},Q=(0,r.vU)({dex:{id:"U8QBHO",defaultMessage:"Powered by"},tab_oci:{id:"eyMKyf",defaultMessage:"OCI"},tab_astrolecent:{id:"CrAj8T",defaultMessage:"Astrolecent"}}),Y="astrolecent",ee=()=>{let e=(0,i.Z)(),a=(0,n.useMemo)(()=>({oci:{title:e.formatMessage(Q.tab_oci),image:O.l.OCI_SWAP},[Y]:{title:e.formatMessage(Q.tab_astrolecent),image:O.l.ASTROLESCENT}}),[]),[t,r]=(0,n.useState)("oci");return(0,s.jsxs)(u.x,{paddingBottom:"small",children:[(0,s.jsxs)(u.x,{className:"x3la7g4 _5baftf4 _5baftfg _5baftf1y _5baftf5p",children:[(0,s.jsx)(u.x,{paddingRight:"small",children:(0,s.jsx)(A.Z,{size:"medium",children:e.formatMessage(Q.dex)})}),(0,s.jsxs)(k.h_,{children:[(0,s.jsx)(k.$F,{asChild:!0,children:(0,s.jsxs)(u.x,{component:"button",display:"inline-flex",alignItems:"center",className:(0,y.Z)(z.h,z.V),children:[(0,s.jsx)(A.Z,{size:"medium",color:"inherit",children:a[t].title}),(0,s.jsx)(u.x,{paddingLeft:"small",children:(0,s.jsx)(w.H,{size:"small",address:a[t].image})})]})}),(0,s.jsx)(k.cq,{children:(0,s.jsx)(k.AW,{align:"start",sideOffset:2,className:"x3la7g0",children:Object.entries(a).map(e=>{let[a,{title:t,image:n}]=e;return(0,s.jsxs)(k.Xi,{onSelect:()=>r(a),children:[(0,s.jsx)(k.Kp,{children:(0,s.jsx)(w.H,{size:"small",address:n})}),(0,s.jsx)(u.x,{display:"flex",marginLeft:"small",children:(0,s.jsx)(A.Z,{size:"xsmall",truncate:!0,children:t})})]},a)})})})]})]}),{oci:(0,s.jsx)(J,{}),[Y]:(0,s.jsx)($,{})}[t]]})},ea=(0,r.vU)({button_add_swap:{id:"Clukea",defaultMessage:"Add another swap"},button_submit:{id:"s8BnAC",defaultMessage:"Swap"},validation_token_required:{id:"IXFNmv",defaultMessage:"Resource is required"},validation_token:{id:"gO3ocF",defaultMessage:"Please select token"},validation_amount_required:{id:"jU3fsF",defaultMessage:"Amount is required"},validation_amount:{id:"FrNeCi",defaultMessage:"Please enter a valid amount"},validation_account:{id:"w2XWRt",defaultMessage:"Please select account"},validation_swaps:{id:"WsQhkr",defaultMessage:"At least one action is required"},error_toast:{id:"fjqZcw",defaultMessage:"Failed submitting transaction to the network"},success_toast:{id:"Gkt0d0",defaultMessage:"Successfully submitted transaction to the network"},toast_action_label:{id:"K7AkdL",defaultMessage:"Show"}}),et={swaps:[{dex:"oci",manifest:"",account:"",from:[{address:"",amount:0}],to:[{address:"",amount:0}]}]},es=()=>{let e=(0,i.Z)(),a=(0,M.p)(),t=(0,o.TH)(),r=(0,o.s0)(),y=(0,j.h9)(),[k]=(0,l.lr)(),w=(0,v.z)(),{data:z}=(0,b.D)(),[A,O]=(0,n.useState)(et),[N,T]=(0,n.useState)();(0,n.useEffect)(()=>{if(!z)return;let e=Object.keys(w);0!==e.length&&O({swaps:[{dex:"oci",manifest:"",account:e[0],from:[{address:z.resourceAddresses.xrd,amount:0}],to:[{address:1===y?"resource_rdx1t52pvtk5wfhltchwh3rkzls2x0r98fw9cjhpyrf3vsykhkuwrf7jg8":"",amount:0}]}]})},[y,w,z]);let E=(0,n.useMemo)(()=>{let a=d.z.object({address:d.z.string({required_error:e.formatMessage(ea.validation_token_required)}).min(1,e.formatMessage(ea.validation_token)),amount:d.z.coerce.number({required_error:e.formatMessage(ea.validation_amount_required)}).gt(0,{message:e.formatMessage(ea.validation_amount)})});return d.z.object({swaps:d.z.array(d.z.object({dex:d.z.literal("oci").or(d.z.literal("astrolecent")),manifest:d.z.string().min(1),account:d.z.string().min(1,e.formatMessage(ea.validation_account)),from:d.z.array(a).length(1),to:d.z.array(a).length(1)})).min(1,e.formatMessage(ea.validation_swaps))})},[]),P=async s=>{T(void 0);let n=E.safeParse(s);if(!1===n.success){T(n.error);return}let i=s.swaps.map(e=>e.manifest).join("\n");await a({version:1,transactionManifest:i}).then(a=>{c.A.success(e.formatMessage(ea.success_toast),{description:a.status,action:{label:e.formatMessage(ea.toast_action_label),onClick:()=>{k.set("tx","".concat(a.transactionIntentHash)),r("".concat(t.pathname,"?").concat(k))}}}),O(et)}).catch(a=>{c.A.error(e.formatMessage(ea.error_toast),{description:a.message||a.error})})};return(0,s.jsx)(u.x,{width:"full",children:(0,s.jsxs)(f.l,{onSubmit:P,initialValues:A,errors:null==N?void 0:N.format(),className:"x3la7ga _5baftf4",children:[(0,s.jsx)(u.x,{className:"x3la7g6 _5baftf4 _5baftfg _5baftf5p",children:(0,s.jsx)(p.d,{message:null==N?void 0:N.flatten().formErrors[0]})}),(0,s.jsx)(m.H,{name:"swaps",defaultKeys:1,addTrigger:(0,s.jsx)(u.x,{className:"x3la7ge _5baftf51",children:(0,s.jsx)(h.z,{styleVariant:"secondary",sizeVariant:"large",fullWidth:!0,leftIcon:(0,s.jsx)(u.x,{marginLeft:"small",children:(0,s.jsx)(g.Z,{})}),children:e.formatMessage(ea.button_add_swap)})}),trashTrigger:(0,s.jsx)(u.x,{children:(0,s.jsx)(h.z,{styleVariant:"ghost",sizeVariant:"small",iconOnly:!0,children:(0,s.jsx)(x.Z,{})})}),className:"x3la7gc _5baftf3v _5baftf41 _5baftf47 _5baftf4d _5baftfg _5baftf2m _5baftf3a _5baftf3rh _5baftf8d _5baftf51",children:(0,s.jsx)(ee,{})}),(0,s.jsx)(u.x,{className:"x3la7g2 _5baftf4 _5baftf4v",children:(0,s.jsx)(_.M,{children:(0,s.jsx)(h.z,{sizeVariant:"large",styleVariant:"primary",fullWidth:!0,children:e.formatMessage(ea.button_submit)})})})]})})};var en=es},52311:function(){}}]);